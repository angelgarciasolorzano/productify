DROP DATABASE IF EXISTS productos;
CREATE DATABASE productos;
USE productos;

CREATE TABLE cargos (
  id_cargo INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  nombre_cargo VARCHAR (50) NOT NULL UNIQUE,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE usuarios (
  id_usuario INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  nombre_usuario VARCHAR(30) NOT NULL,
  apellidos_usuario VARCHAR(30) NOT NULL,
  sexo_usuario ENUM('M', 'F') NOT NULL, 
  cedula_usuario CHAR(16) NOT NULL UNIQUE, 
  departamento_usuario VARCHAR(30) NULL, 
  direccion_usuario VARCHAR(100) NULL, 
  correo_usuario VARCHAR(100) NOT NULL UNIQUE, 
  contra_usuario VARCHAR(100) NOT NULL,
  estado_usuario ENUM('activo', 'inactivo') DEFAULT 'activo',
  id_cargo_fk INT NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (id_cargo_fk) REFERENCES cargos(id_cargo)
);

CREATE TABLE telefonos (
  id_telefono INT PRIMARY KEY AUTO_INCREMENT,
  operador_telefono ENUM('tigo', 'claro') NULL,
  numero_telefono VARCHAR (15) NULL UNIQUE CHECK (LENGTH(numero_telefono) BETWEEN 8 AND 15),
  id_usuario_fk INT NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (id_usuario_fk) REFERENCES usuarios (id_usuario)
);

CREATE TABLE proveedores (
  id_proveedor INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  nombre_proveedor VARCHAR (30) NOT NULL,
  email_proveedor VARCHAR (30) NOT NULL UNIQUE,
  telefono_proveedor VARCHAR (15) NOT NULL UNIQUE CHECK (LENGTH(telefono_proveedor) BETWEEN 8 AND 15),
  direccion_proveedor VARCHAR (100) NULL,
  estado_proveedor ENUM('activo', 'inactivo') DEFAULT 'activo',
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE categorias (
  id_categoria INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  nombre_categoria VARCHAR (50) NOT NULL,
  descripcion_categoria VARCHAR (100) NULL,
  estado_categoria ENUM('activo', 'inactivo') DEFAULT 'activo',
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE productos (
  id_producto INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  nombre_producto VARCHAR (50) NOT NULL,
  descripcion_producto VARCHAR (100) NULL,
  precio_compra DECIMAL (10, 2) NOT NULL,
  precio_venta DECIMAL (10, 2) NOT NULL,
  stock_producto INT NOT NULL,
  fecha_vencimiento_producto DATE NULL,
  imagen_producto VARCHAR (255) NULL,
  estado_producto ENUM ('activo', 'inactivo') DEFAULT 'activo',
  id_categoria_fk INT NULL,
  id_usuario_fk INT NOT NULL,
  createdAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updatedAt DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

  FOREIGN KEY (id_categoria_fk) REFERENCES categorias (id_categoria),
  FOREIGN KEY (id_usuario_fk) REFERENCES usuarios (id_usuario)
);

CREATE TABLE productos_proveedores (
  id_producto_proveedor INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
  id_proveedor_fk INT NULL,
  id_producto_fk INT NOT NULL,

  FOREIGN KEY (id_proveedor_fk) REFERENCES proveedores (id_proveedor),
  FOREIGN KEY (id_producto_fk) REFERENCES productos (id_producto)
);